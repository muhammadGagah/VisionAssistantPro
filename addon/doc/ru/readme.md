# Vision Assistant Pro - документация 

**Vision Assistant Pro** — это продвинутый мультимодальный AI-ассистент для NVDA. Он использует модели Google Gemini для интеллектуального чтения экрана, перевода, голосового ввода и анализа документов.

_Это дополнение было выпущено для сообщества в честь Международного дня инвалидов._

## 1. Установка и настройка

Перейдите в **Меню NVDA > Параметры > Настройки > Vision Assistant Pro**.

- **API-ключ:** Обязательное поле. Вы можете ввести несколько ключей (разделяя их запятыми или переносом строки). При достижении лимита ассистент автоматически переключится на следующий ключ.
- **Модель ИИ:** Выберите между **Flash** (Самая быстрая/бесплатная), **Lite** или **Pro** (Высокий интеллект).
- **URL прокси:** Необязательно. Используйте этот адрес, если Google заблокирован в вашем регионе. Это должен быть веб-адрес, который выступает в роли моста к Gemini API.
- **OCR-движок:** Выберите **Chrome (быстрый)** для быстрых результатов или **Gemini (с форматированием)** для лучшего сохранения структуры документа и распознавания таблиц.
- **Голос TTS:** Выберите предпочтительный голос для создания аудиофайлов из страниц документа.
- **Умная замена (Smart Swap):** Автоматически меняет языки местами, если исходный текст совпадает с целевым языком.
- **Прямой вывод:** Пропускает окно чата и озвучивает ответ ИИ напрямую. **Примечание:** Даже в этом режиме вы можете нажать **Пробел** в командном слое, чтобы открыть последний результат в диалоге чата.
- **Интеграция с буфером обмена:** Автоматически копирует ответ ИИ в буфер обмена.

## 2. Командный слой и сочетания клавиш

Чтобы избежать конфликтов клавиш, это дополнение использует **Командный слой**.
1. Нажмите **NVDA + Shift + V** (Главная клавиша) для активации слоя (вы услышите звуковой сигнал).
2. Отпустите клавиши, затем нажмите одну из следующих клавиш:

| Клавиша       | Функция                   | Описание                                                                 |
|---------------|---------------------------|-----------------------------------------------------------------------------|
| **T**         | Умный перевод             | Переводит текст под курсором обзора или выделенный текст.                        |
| **Shift + T** | Перевод из буфера обмена  | Переводит содержимое буфера обмена.                              |
| **R**         | Обработка текста          | Резюмировать, Исправить грамматику, Объяснить или выполнить **Пользовательский промпт**.                 |
| **V**         | Анализ объекта            | Описывает текущий объект обзора.                                     |
| **O**         | Анализ всего экрана       | Анализирует содержимое и структуру всего экрана.                              |
| **Shift + V** | Анализ онлайн-видео       | Анализирует видео с **YouTube**, **Instagram**, **TikTok** или **Twitter (X)**.  |
| **D**         | Чтение документов         | Расширенное чтение PDF и изображений с выбором диапазона страниц.               |
| **F**         | OCR файлов                | Прямое распознавание текста из выбранных изображений, PDF или TIFF.            |
| **A**         | Транскрибация аудио       | Преобразует файлы MP3, WAV или OGG в текст.                                |
| **C**         | Решение CAPTCHA           | Захватывает и решает CAPTCHA на экране или из объекта обзора.             |
| **S**         | Умный диктант             | Преобразует речь в текст. Нажмите для начала записи, нажмите снова для остановки/вставки текста.      |
| **L**         | Отчет о состоянии         | Сообщает о текущем прогрессе (например, "Сканирование...", "Ожидание").                   |
| **U**         | Проверка обновлений       | Вручную проверяет GitHub на наличие новой версии дополнения.                 |
| **Пробел**    | Показать последний результат | Отображает последний ответ ИИ в диалоге чата для повторного просмотра или уточняющих вопросов.        |
| **H**         | Помощь по командам        | Показывает список всех доступных сочетаний клавиш в командном слое.        |

### 2.1 Сочетания клавиш в окне просмотра документов
После открытия документа через команду **D**:
- **Ctrl + PageDown:** Перейти на следующую страницу (озвучивается номер страницы).
- **Ctrl + PageUp:** Перейти на предыдущую страницу (озвучивается номер страницы).
- **Alt + A:** Открыть диалог чата для вопросов по документу.
- **Alt + R:** Принудительно пересканировать текущую страницу или все страницы с помощью движка Gemini.
- **Alt + G:** Сгенерировать и сохранить высококачественный аудиофайл (WAV) из содержимого.
- **Alt + S / Ctrl + S:** Сохранить извлеченный текст как TXT или HTML файл.

## 3. Пользовательские промпты и переменные

Откройте **Настройки > Промпты > Управление промптами...** для настройки системных и пользовательских промптов.

- **Вкладка "Промпты по умолчанию":** редактирование встроенных промптов. Вы можете сбросить отдельный промпт или восстановить все настройки по умолчанию.
- **Вкладка "Пользовательские промпты":** добавление, редактирование, удаление и изменение порядка пользовательских промптов.
- **Кнопка "Руководство по переменным":** открывает окно справки со всеми поддерживаемыми переменными и типами ввода.

### Доступные переменные

| Переменная        | Описание                                      | Тип ввода       |
|-------------------|-----------------------------------------------|------------------|
| `[selection]`     | Текущий выделенный текст                      | Текст             |
| `[clipboard]`     | Содержимое буфера обмена                      | Текст             |
| `[screen_obj]`    | Снимок экрана объекта обзора                  | Изображение            |
| `[screen_full]`   | Снимок всего экрана                           | Изображение            |
| `[file_ocr]`      | Выбор файла изображения/PDF для извлечения текста | Изображение, PDF, TIFF |
| `[file_read]`     | Выбор документа для чтения                    | TXT, Код, PDF   |
| `[file_audio]`    | Выбор аудиофайла для анализа                   | MP3, WAV, OGG    |

### Примеры пользовательских промптов

- **Быстрый OCR:** `Мой OCR:[file_ocr]`
- **Перевести изображение:** `Перевести изображение:Извлеки текст из этого изображения и переведи на русский. [file_ocr]`
- **Анализ аудио:** `Резюме аудио:Прослушай эту запись и выдели основные мысли. [file_audio]`
- **Отладка кода:** `Отладка:Найди ошибки в этом коде и объясни их: [selection]`

***
**Примечание:** Для всех функций ИИ требуется активное интернет-соединение. Многостраничные документы и TIFF-файлы обрабатываются автоматически.

## 4. Поддержка и сообщество

Будьте в курсе последних новостей, функций и релизов:
- **Telegram-канал:** [t.me/VisionAssistantPro](https://t.me/VisionAssistantPro) (На английском)
- **GitHub Issues:** Для сообщений об ошибках и запросов новых функций.

## Что нового в версии 4.6
* **Интерактивный повтор результатов:** Добавлена клавиша **Пробел** в командный слой, позволяющая мгновенно открыть последний ответ ИИ в окне чата для уточняющих вопросов, даже если активен режим "Прямой вывод".
* **Telegram-канал сообщества:** Добавлена ссылка на "Официальный Telegram-канал" в меню "Сервис" NVDA, обеспечивающая быстрый доступ к последним новостям, функциям и релизам.
* **Повышенная стабильность ответов:** Оптимизирована базовая логика для функций перевода, OCR и Vision, чтобы обеспечить более надежную производительность и более плавную работу при использовании прямого речевого вывода.
* **Улучшенные подсказки в интерфейсе:** Обновлены описания в настройках и документация, чтобы лучше объяснить новую систему повтора результатов и то, как она работает вместе с настройками прямого вывода.

## Что нового в версии 4.5
* **Расширенный менеджер промптов:** Представлен специальный диалог управления в настройках для настройки системных промптов по умолчанию и управления пользовательскими промптами с полной поддержкой добавления, редактирования, изменения порядка и предварительного просмотра.
* **Расширенная поддержка прокси:** Устранены проблемы с сетевым подключением. Настройки прокси, заданные пользователем, теперь строго применяются ко всем API-запросам, включая перевод, OCR и генерацию речи.
* **Автоматическая миграция данных:** Встроена интеллектуальная система миграции для автоматического обновления устаревших конфигураций промптов до надежного формата JSON v2 при первом запуске без потери данных.
* **Обновлена совместимость (2025.1):** Минимальная требуемая версия NVDA установлена на 2025.1 из-за зависимостей библиотек в расширенных функциях, таких как средство чтения документов, для обеспечения стабильной работы.
* **Оптимизированный интерфейс настроек:** Упрощен интерфейс настроек путем перемещения управления промптами в отдельный диалог, что обеспечивает более чистый и доступный пользовательский опыт.
* **Руководство по переменным промптов:** Добавлено встроенное руководство в диалогах промптов, чтобы помочь пользователям легко идентифицировать и использовать динамические переменные, такие как [selection], [clipboard] и [screen_obj].

## Что нового в версии 4.0.3
* **Повышенная устойчивость сети:** Добавлен механизм автоматических повторных попыток для лучшей обработки нестабильных интернет-соединений и временных ошибок сервера, обеспечивая более надежные ответы ИИ.
* **Диалог визуального перевода:** Представлено отдельное окно для результатов перевода. Пользователи теперь могут легко перемещаться и читать длинные переводы построчно, аналогично результатам OCR.
* **Объединенное форматированное представление:** Функция "Просмотр форматированного" в средстве чтения документов теперь отображает все обработанные страницы в одном организованном окне с четкими заголовками страниц.
* **Оптимизированный рабочий процесс OCR:** Автоматически пропускает выбор диапазона страниц для одностраничных документов, делая процесс распознавания быстрее и плавнее.
* **Улучшенная стабильность API:** Переход на более надежный метод аутентификации на основе заголовков, устраняющий потенциальные ошибки "Все API-ключи не сработали", вызванные конфликтами при ротации ключей.
* **Исправление ошибок:** Устранены несколько потенциальных сбоев, включая проблему во время завершения работы дополнения и ошибку фокуса в диалоге чата.

## Что нового в версии 4.0.1
* **Расширенное средство чтения документов:** Мощное новое средство просмотра PDF и изображений с выбором диапазона страниц, фоновой обработкой и плавной навигацией с помощью `Ctrl+PageUp/Down`.
* **Новое подменю "Сервис":** Добавлено специальное подменю "Vision Assistant" в меню "Сервис" NVDA для более быстрого доступа к основным функциям, настройкам и документации.
* **Гибкая настройка:** Теперь вы можете выбрать предпочтительный OCR-движок и голос TTS прямо на панели настроек.
* **Поддержка нескольких API-ключей:** Добавлена поддержка нескольких ключей Gemini API. В настройках можно вводить по одному ключу на строку или разделять их запятыми.
* **Альтернативный OCR-движок:** Представлен новый OCR-движок для обеспечения надежного распознавания текста даже при достижении лимитов Gemini API.
* **Умная ротация API-ключей:** Автоматически переключается на самый быстрый рабочий ключ API и запоминает его для обхода лимитов.
* **Документ в MP3/WAV:** Встроенная возможность генерировать и сохранять высококачественные аудиофайлы в форматах MP3 (128kbps) и WAV непосредственно в средстве чтения.
* **Поддержка Instagram Stories:** Добавлена возможность описывать и анализировать истории (Stories) Instagram по их URL-адресам.
* **Поддержка TikTok:** Представлена поддержка видео TikTok, позволяющая проводить полное визуальное описание и транскрибацию аудио клипов.
* **Обновленный диалог обновлений:** Отличается новым доступным интерфейсом с прокручиваемым текстовым полем для четкого чтения изменений в версиях перед установкой.
* **Унифицированный статус и UX:** Стандартизированы диалоги файлов по всему дополнению и улучшена команда 'L' для отчета о прогрессе в реальном времени.

## Что нового в версии 3.6.0
* **Система помощи:** Добавлена команда помощи (`H`) в командном слое для предоставления легкодоступного списка всех сочетаний клавиш и их функций.
* **Анализ онлайн-видео:** Расширена поддержка видео **Twitter (X)**. Также улучшено определение URL и стабильность для более надежной работы.
* **Поддержка проекта:** Добавлен необязательный диалог пожертвований для пользователей, желающих поддержать будущие обновления и постоянное развитие проекта.

## Что нового в версии 3.5.0
* **Командный слой:** Внедрена система командного слоя (по умолчанию `NVDA+Shift+V`) для группировки сочетаний клавиш под одной главной клавишей. Например, вместо нажатия `NVDA+Control+Shift+T` для перевода теперь нужно нажать `NVDA+Shift+V`, а затем `T`.
* **Анализ онлайн-видео:** Добавлена новая функция для анализа видео с YouTube и Instagram непосредственно по предоставленному URL-адресу.

## Что нового в версии 3.1.0
* **Режим прямого вывода:** Добавлена опция для пропуска диалога чата и прямого озвучивания ответов ИИ для более быстрого и плавного взаимодействия.
* **Интеграция с буфером обмена:** Добавлена новая настройка для автоматического копирования ответов ИИ в буфер обмена.

## Что нового в версии 3.0
* **Новые языки:** Добавлены переводы на **персидский** и **вьетнамский** языки.
* **Расширенные модели ИИ:** Переработан список выбора моделей с четкими префиксами (`[Free]`, `[Pro]`, `[Auto]`), чтобы помочь пользователям различать бесплатные и модели с ограничениями (платные). Добавлена поддержка **Gemini 3.0 Pro** и **Gemini 2.0 Flash Lite**.
* **Стабильность диктовки:** Значительно повышена стабильность функции "Умный диктант". Добавлена проверка безопасности для игнорирования аудиоклипов короче 1 секунды, предотвращающая галлюцинации ИИ и пустые ошибки.
* **Обработка файлов:** Исправлена проблема, из-за которой загрузка файлов с именами не на английском языке завершалась ошибкой.
* **Оптимизация промптов:** Улучшена логика перевода и структурированы результаты Vision.

## Что нового в версии 2.9
* **Добавлены переводы на французский и турецкий языки.**
* **Форматированный просмотр:** Добавлена кнопка "Просмотр форматированного" в диалогах чата для просмотра беседы с правильным стилем (Заголовки, Жирный, Код) в стандартном окне для просмотра.
* **Настройка Markdown:** Добавлена новая опция "Очищать Markdown в чате" в настройках. Снятие этой опции позволяет пользователям видеть необработанный синтаксис Markdown (например, `**`, `#`) в окне чата.
* **Управление диалогами:** Исправлена проблема, из-за которой окна "Обработка текста" или чата открывались несколько раз или не могли правильно получить фокус.
* **Улучшения UX:** Стандартизированы заголовки диалогов выбора файлов на "Открыть" и удалены избыточные речевые уведомления (например, "Открывается меню...") для более плавной работы.

## Что нового в версии 2.8
* Добавлен итальянский перевод.
* **Отчет о состоянии:** Добавлена новая команда (NVDA+Control+Shift+I) для объявления текущего статуса дополнения (например, "Загрузка...", "Анализ...").
* **Экспорт в HTML:** Кнопка "Сохранить содержимое" в диалогах результатов теперь сохраняет вывод в виде форматированного HTML-файла, сохраняя такие стили, как заголовки и жирный текст.
* **Интерфейс настроек:** Улучшен макет панели настроек с доступной группировкой.
* **Новые модели:** Добавлена поддержка gemini-flash-latest и gemini-flash-lite-latest.
* **Языки:** Добавлен непальский в список поддерживаемых языков.
* **Логика меню "Обработка текста":** Исправлена критическая ошибка, из-за которой команды "Обработка текста" не работали, если язык интерфейса NVDA не был английским.
* **Диктовка:** Улучшено определение тишины для предотвращения некорректного вывода текста при отсутствии речевого ввода.
* **Настройки обновлений:** "Проверять обновления при запуске" теперь отключено по умолчанию для соответствия правилам магазина дополнений.
* Очистка кода.

## Что нового в версии 2.7
* Выполнена миграция структуры проекта на официальный шаблон дополнений NV Access для лучшего соответствия стандартам.
* Реализована логика автоматических повторных попыток для ошибок HTTP 429 (Превышение лимита запросов), чтобы обеспечить надежность при высоком трафике.
* Оптимизированы промпты перевода для более высокой точности и улучшенной обработки логики "Умной замены".
* Обновлен русский перевод.

## Что нового в версии 2.6
* Добавлена поддержка русского перевода (Спасибо nvda-ru).
* Обновлены сообщения об ошибках для предоставления более информативной обратной связи относительно подключения.
* Изменен целевой язык по умолчанию на английский.

## Что нового в версии 2.5
* Добавлена команда OCR файлов (NVDA+Control+Shift+F).
* Добавлена кнопка "Сохранить чат" в диалогах результатов.
* Реализована полная поддержка локализации (i18n).
* Переход на использование встроенного модуля звуковых сигналов NVDA для аудиообратной связи.
* Переход на Gemini File API для лучшей обработки PDF и аудиофайлов.
* Исправлен сбой при переводе текста, содержащего фигурные скобки.

## Что нового в версии 2.1.1
* Исправлена проблема, из-за которой переменная `[file_ocr]` некорректно работала в пользовательских промптах.

## Что нового в версии 2.1
* Стандартизированы все сочетания клавиш для использования NVDA+Control+Shift с целью устранения конфликтов с раскладкой "Ноутбука" NVDA и системными горячими клавишами.

## Что нового в версии 2.0
* Реализована встроенная система автообновления.
* Добавлен умный кэш переводов для мгновенного получения ранее переведенного текста.
* Добавлена память разговора для контекстного уточнения результатов в диалогах чата.
* Добавлена отдельная команда перевода из буфера обмена (NVDA+Control+Shift+Y).
* Оптимизированы промпты ИИ для строгого соблюдения вывода на целевом языке.
* Исправлен сбой, вызванный специальными символами во входном тексте.

## Что нового в версии 1.5
* Добавлена поддержка более 20 новых языков.
* Реализован интерактивный диалог уточнения для дополнительных вопросов.
* Добавлена функция "Умный диктант".
* Добавлена категория "Vision Assistant" в диалог жестов ввода NVDA.
* Исправлены сбои COMError в определенных приложениях, таких как Firefox и Word.
* Добавлен механизм автоматических повторных попыток при ошибках сервера.

## Что нового в версии 1.0
* Первоначальный выпуск.