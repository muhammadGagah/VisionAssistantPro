# Vision Assistant Pro 文档

**Vision Assistant Pro** 是专为 NVDA 设计的高级多模态 AI 助手。它利用 Google 的 Gemini 模型提供智能屏幕阅读、翻译、语音听写和文档分析功能。

_本插件的发布旨在纪念国际残疾人日，以此回馈社区。_

## 1. 设置与配置

请前往 **NVDA 菜单 > 偏好设置 > 设置 > Vision Assistant Pro**。

- **API 密钥：** 必填项。您可以输入多个密钥（用逗号或换行符分隔）。如果达到配额限制，助手将在它们之间自动轮换。
- **AI 模型：** 选择 **Flash**（最快/免费）、**Lite** 或 **Pro**（高智能）模型。
- **代理 URL：** 选填项。如果您所在地区无法访问 Google，请使用此项。它必须是一个充当 Gemini API 桥梁的网址。
- **OCR 引擎：** 选择 **Chrome（快速）** 以获得快速结果，或选择 **Gemini（格式化）** 以获得更佳的布局保留和表格识别效果。
- **TTS 语音：** 选择用于从文档页面生成音频文件的首选语音风格。
- **智能切换：** 如果源文本与目标语言匹配，则自动交换语言。
- **直接输出：** 跳过聊天窗口，直接通过语音朗读 AI 的回复。**注意：** 即使在此模式下，您也可以在命令层按 **空格键 (Space)** 在聊天对话框中重新打开上一次结果。
- **剪贴板集成：** 自动将 AI 回复复制到剪贴板。

## 2. 命令层与快捷键

为防止键盘冲突，本插件使用**命令层**。
1. 按 **NVDA + Shift + V**（主键）激活该层（您会听到“嘟”的一声）。
2. 松开按键，然后按以下单键之一：

| 按键          | 功能                     | 描述                                                                        |
|---------------|--------------------------|-----------------------------------------------------------------------------|
| **T**         | 智能翻译                 | 翻译导航对象光标下的文本或选中文本。                                        |
| **Shift + T** | 剪贴板翻译               | 翻译当前剪贴板中的内容。                                                    |
| **R**         | 文本润色                 | 摘要、语法修复、解释或运行**自定义提示词**。                                |
| **V**         | 对象视觉                 | 描述当前导航对象。                                                          |
| **O**         | 全屏视觉                 | 分析整个屏幕布局和内容。                                                    |
| **Shift + V** | 在线视频分析             | 通过 URL 分析 **YouTube**、**Instagram**、**TikTok** 或 **Twitter (X)** 视频。|
| **D**         | 文档阅读器               | 具有页面范围选择功能的高级 PDF 和图像阅读器。                               |
| **F**         | 文件 OCR                 | 直接从选定的图像、PDF 或 TIFF 文件中识别文本。                              |
| **A**         | 音频转录                 | 将 MP3、WAV 或 OGG 文件转录为文本。                                         |
| **C**         | 验证码求解器             | 捕获并解析屏幕或导航对象上的验证码。                                        |
| **S**         | 智能听写                 | 将语音转换为文本。按一次开始录音，再按一次停止/输入。                       |
| **L**         | 状态报告                 | 播报当前进度（例如“正在扫描...”、“空闲”）。                                 |
| **U**         | 检查更新                 | 手动检查 GitHub 以获取插件的最新版本。                                      |
| **Space**     | 调用上一次结果           | 在聊天对话框中显示上一次 AI 回复，以便查看或进行后续提问。                  |
| **H**         | 命令帮助                 | 显示命令层内所有可用快捷键的列表。                                          |

### 2.1 文档阅读器快捷键（阅读器内部）
通过 **D** 命令打开文档后：
- **Ctrl + PageDown：** 移至下一页（播报页码）。
- **Ctrl + PageUp：** 移至上一页（播报页码）。
- **Alt + A：** 打开聊天对话框，就文档内容进行提问。
- **Alt + R：** 强制使用 Gemini 引擎重新扫描当前页面或所有页面。
- **Alt + G：** 从内容生成并保存高质量音频文件 (WAV)。
- **Alt + S / Ctrl + S：** 将提取的文本保存为 TXT 或 HTML 文件。

## 3. 自定义提示词与变量

打开 **设置 > 提示词 > 管理提示词...** 以配置系统和自定义提示词。

- **默认提示词标签页：** 编辑内置提示词。您可以重置单个提示词或重置所有默认值。
- **自定义提示词标签页：** 添加、编辑、删除和重新排序自定义提示词。
- **变量指南按钮：** 打开一个包含所有支持变量和输入类型的帮助窗口。

### 可用变量

| 变量              | 描述                                       | 输入类型         |
|-------------------|--------------------------------------------|------------------|
| `[selection]`     | 当前选中的文本                             | 文本             |
| `[clipboard]`     | 剪贴板内容                                 | 文本             |
| `[screen_obj]`    | 导航对象的截图                             | 图像             |
| `[screen_full]`   | 全屏截图                                   | 图像             |
| `[file_ocr]`      | 选择用于提取文本的图像/PDF文件             | 图像, PDF, TIFF  |
| `[file_read]`     | 选择用于阅读的文档                         | TXT, 代码, PDF   |
| `[file_audio]`    | 选择用于分析的音频文件                     | MP3, WAV, OGG    |

### 自定义提示词示例

- **快速 OCR：** `My OCR:[file_ocr]`
- **翻译图片：** `Translate Img:Extract text from this image and translate to English. [file_ocr]`
- **分析音频：** `Summarize Audio:Listen to this recording and summarize the main points. [file_audio]`
- **代码调试器：** `Debug:Find bugs in this code and explain them: [selection]`

***
**注意：** 所有 AI 功能都需要有效的互联网连接。多页文档和 TIFF 文件会自动处理。

## 4. 支持与社区

获取最新新闻、功能和发布信息：
- **Telegram 频道：** [t.me/VisionAssistantPro](https://t.me/VisionAssistantPro)
- **GitHub Issues：** 用于错误报告和功能请求。

## 4.6 版本变更
* **交互式结果调用：** 在命令层添加了 **空格键 (Space)**，允许用户在聊天窗口中立即重新打开上一次 AI 回复，以便进行后续提问，即便在“直接输出”模式下也有效。
* **Telegram 社区中心：** 在 NVDA 工具菜单中添加了“Telegram 频道”链接，提供快速获取最新新闻、功能和发布信息的方式。
* **增强响应稳定性：** 优化了翻译、OCR 和视觉功能的核心逻辑，确保更可靠的性能，并在使用直接语音输出时提供更流畅的体验。
* **改进界面引导：** 更新了设置说明和文档，以更好地解释新的调用系统及其如何与直接输出设置配合工作。

## 4.5 版本变更
* **高级提示词管理器：** 在设置中引入了专用的管理对话框，用于自定义默认系统提示词和管理用户定义的提示词，完全支持添加、编辑、重新排序和预览。
* **全面的代理支持：** 解决了网络连接问题，确保用户配置的代理设置严格应用于所有 API 请求，包括翻译、OCR 和语音生成。
* **自动数据迁移：** 集成了智能迁移系统，在首次运行时自动将旧版提示词配置升级为稳健的 v2 JSON 格式，且不会丢失数据。
* **更新兼容性 (2025.1)：** 由于文档阅读器等高级功能中的库依赖关系，将最低所需的 NVDA 版本设置为 2025.1，以确保稳定的性能。
* **优化设置界面：** 通过将提示词管理重组为单独的对话框，简化了设置界面，提供了更整洁、更易用的用户体验。
* **提示词变量指南：** 在提示词对话框中添加了内置指南，帮助用户轻松识别和使用动态变量，如 [selection]、[clipboard] 和 [screen_obj]。

## 4.0.3 版本变更
*   **增强网络弹性：** 添加了自动重试机制，以更好地处理不稳定的互联网连接和临时服务器错误，确保 AI 回复更加可靠。
*   **可视化翻译对话框：** 引入了用于翻译结果的专用窗口。用户现在可以像查看 OCR 结果一样，轻松地逐行导航和阅读长篇翻译。
*   **聚合格式化视图：** 文档阅读器中的“查看格式化内容”功能现在可以在一个带有清晰页眉的有序窗口中显示所有已处理的页面。
*   **优化 OCR 工作流：** 对单页文档自动跳过页面范围选择，使识别过程更快、更无缝。
*   **提高 API 稳定性：** 切换到更稳健的基于请求头的验证方法，解决了由密钥轮换冲突导致的潜在“所有 API 密钥失败”错误。
*   **错误修复：** 解决了几个潜在的崩溃问题，包括插件终止期间的问题和聊天对话框中的焦点错误。

## 4.0.1 版本变更
*   **高级文档阅读器：** 强大的 PDF 和图像新阅读器，具有页面范围选择、后台处理和无缝 `Ctrl+PageUp/Down` 导航功能。
*   **新工具子菜单：** 在 NVDA 的工具菜单下添加了专用的“Vision Assistant”子菜单，以便更快捷地访问核心功能、设置和文档。
*   **灵活定制：** 您现在可以直接从设置面板选择首选的 OCR 引擎和 TTS 语音。
*   **多 API 密钥支持：** 添加了对多个 Gemini API 密钥的支持。您可以在设置中每行输入一个密钥，或用逗号分隔它们。
*   **替代 OCR 引擎：** 引入了新的 OCR 引擎，确保即使在达到 Gemini API 配额限制时也能可靠地识别文本。
*   **智能 API 密钥轮换：** 自动切换并记住最快的工作 API 密钥，以绕过配额限制。
*   **文档转 MP3/WAV：** 集成了直接在阅读器内生成并保存高质量 MP3 (128kbps) 和 WAV 格式音频文件的功能。
*   **Instagram 快拍支持：** 添加了使用 URL 描述和分析 Instagram 快拍 (Stories) 的功能。
*   **TikTok 支持：** 引入了对 TikTok 视频的支持，允许对剪辑进行完整的视觉描述和音频转录。
*   **重新设计的更新对话框：** 具有新的无障碍界面，带有一个可滚动的文本框，以便在安装前清晰地阅读版本更改。
*   **统一状态与用户体验：** 统一了整个插件的文件对话框，并增强了 'L' 命令以报告实时进度。

## 3.6.0 版本变更
*   **帮助系统：** 在命令层中添加了帮助命令 (`H`)，提供易于访问的所有快捷键及其功能列表。
*   **在线视频分析：** 扩展支持以包含 **Twitter (X)** 视频。还改进了 URL 检测和稳定性，以获得更可靠的体验。
*   **项目贡献：** 为希望支持项目未来更新和持续发展的用户添加了可选的捐赠对话框。

## 3.5.0 版本变更
*   **命令层：** 引入了命令层系统（默认：`NVDA+Shift+V`），将快捷键分组在一个主键下。例如，翻译不再按 `NVDA+Control+Shift+T`，而是先按 `NVDA+Shift+V`，再按 `T`。
*   **在线视频分析：** 添加了一项新功能，通过提供 URL 直接分析 YouTube 和 Instagram 视频。

## 3.1.0 版本变更
*   **直接输出模式：** 添加了一个选项以跳过聊天对话框，直接通过语音听到 AI 的回复，从而获得更快、更无缝的体验。
*   **剪贴板集成：** 添加了一项新设置，可自动将 AI 回复复制到剪贴板。

## 3.0 版本变更
*   **新语言：** 添加了**波斯语**和**越南语**翻译。
*   **扩展 AI 模型：** 使用清晰的前缀（`[免费]`、`[Pro]`、`[自动]`）重新组织了模型选择列表，帮助用户区分免费模型和有速率限制（付费）的模型。添加了对 **Gemini 3.0 Pro** 和 **Gemini 2.0 Flash Lite** 的支持。
*   **听写稳定性：** 显著提高了智能听写的稳定性。添加了安全检查以忽略短于 1 秒的音频片段，防止 AI 产生幻觉和空错误。
*   **文件处理：** 修复了上传非英文名称文件会失败的问题。
*   **提示词优化：** 改进了翻译逻辑和结构化视觉结果。

## 2.9 版本变更
*   **添加了法语和土耳其语翻译。**
*   **格式化视图：** 在聊天对话框中添加了“查看格式化内容”按钮，以便在标准浏览窗口中查看具有适当样式（标题、粗体、代码）的对话。
*   **Markdown 设置：** 在设置中添加了新选项“在聊天中清理 Markdown”。取消选中此项允许用户在聊天窗口中查看原始 Markdown 语法（例如 `**`，`#`）。
*   **对话框管理：** 修复了“文本润色”或聊天窗口会多次打开或无法正确聚焦的关键错误。
*   **用户体验改进：** 将文件对话框标题统一为“打开”，并删除了多余的语音播报（例如“正在打开菜单...”），以获得更流畅的体验。

## 2.8 版本变更
* 添加了意大利语翻译。
* **状态报告：** 添加了一个新命令 (NVDA+Control+Shift+I) 来播报插件的当前状态（例如“正在上传...”、“正在分析...”）。
* **HTML 导出：** 结果对话框中的“保存内容”按钮现在将输出保存为格式化的 HTML 文件，保留标题和粗体文本等样式。
* **设置界面：** 通过无障碍分组改进了设置面板的布局。
* **新模型：** 添加了对 gemini-flash-latest 和 gemini-flash-lite-latest 的支持。
* **语言：** 在支持的语言中添加了尼泊尔语。
* **润色菜单逻辑：** 修复了一个严重错误，即如果 NVDA 界面语言不是英语，“润色文本”命令会失败。
* **听写：** 改进了静音检测，以防止在没有语音输入时输出错误的文本。
* **更新设置：** 为了遵守插件商店政策，“启动时检查更新”现在默认为禁用。
* 代码清理。

## 2.7 版本变更
* 将项目结构迁移到官方 NV Access 插件模板，以更好地符合标准。
* 实施了针对 HTTP 429（速率限制）错误的自动重试逻辑，以确保高流量期间的可靠性。
* 优化了翻译提示词，以获得更高的准确性和更好的“智能切换”逻辑处理。
* 更新了俄语翻译。

## 2.6 版本变更
* 添加了俄语翻译支持（感谢 nvda-ru）。
* 更新了错误消息，以提供有关连接性的更具描述性的反馈。
* 将默认目标语言更改为英语。

## 2.5 版本变更
* 添加了本地文件 OCR 命令 (NVDA+Control+Shift+F)。
* 在结果对话框中添加了“保存聊天”按钮。
* 实现了完整的本地化支持 (i18n)。
* 将音频反馈迁移到 NVDA 的原生提示音模块。
* 切换到 Gemini 文件 API，以更好地处理 PDF 和音频文件。
* 修复了翻译包含花括号的文本时崩溃的问题。

## 2.1.1 版本变更
* 修复了 `[file_ocr]` 变量在自定义提示词中无法正常工作的问题。

## 2.1 版本变更
* 将所有快捷键标准化为使用 NVDA+Control+Shift，以消除与 NVDA 笔记本布局和系统热键的冲突。

## 2.0 版本变更
* 实现了内置自动更新系统。
* 添加了智能翻译缓存，用于即时检索以前翻译过的文本。
* 添加了对话记忆，以便在聊天对话框中根据上下文完善结果。
* 添加了专用剪贴板翻译命令 (NVDA+Control+Shift+Y)。
* 优化了 AI 提示词，以严格强制执行目标语言输出。
* 修复了输入文本中包含特殊字符导致的崩溃问题。

## 1.5 版本变更
* 添加了对 20 多种新语言的支持。
* 实现了用于后续提问的交互式润色对话框。
* 添加了原生智能听写功能。
* 在 NVDA 的“输入手势”对话框中添加了“Vision Assistant”类别。
* 修复了 Firefox 和 Word 等特定应用程序中的 COMError 崩溃问题。
* 添加了针对服务器错误的自动重试机制。

## 1.0 版本变更
* 初始发布。